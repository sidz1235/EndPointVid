<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Analysis</title>
</head>
<body>
    <h1>Video Analysis</h1>

    <h2>Upload Video for Analysis</h2>
    <form id="uploadForm">
        <label for="mobileNumber">Mobile Number:</label>
        <input type="text" id="mobileNumber" name="mobileNumber" required><br><br>
        <label for="countryCode">Country Code:</label>
        <input type="text" id="countryCode" name="countryCode" required><br><br>
        <input type="file" id="videoFile" name="videoFile" accept="video/mp4" required><br><br>
        <button type="submit">Upload and Analyse</button>
    </form>

    <div id="analysisResults"></div>

    <h2>Get User Data</h2>
    <form id="userDataForm">
        <label for="userDataMobileNumber">Mobile Number:</label>
        <input type="text" id="userDataMobileNumber" name="mobileNumber" required><br><br>
        <label for="userDataCountryCode">Country Code:</label>
        <input type="text" id="userDataCountryCode" name="countryCode" required><br><br>
        <button type="button" onclick="getUserData()">Get Data</button>
    </form>
    <div id="userData"></div>

    <h2>Available Videos</h2>
    <button onclick="fetchVideos()">Check Video Names</button>
    <select id="videoList" style="display: none;" onchange="displayVideo(this.value)">
        <!-- Video names will be listed here -->
    </select>
    <br><br>
    <div id="video-container" style="display: none;">
        <h2>Selected Video</h2>
        <video id="video-player" controls></video>
        <br><br>
        <h3>Subtitles</h3>
        <div id="subtitles"></div>
    </div>

    <script>
        // Function to upload and analyse video
        document.getElementById('uploadForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const mobileNumber = document.getElementById('mobileNumber').value;
            const countryCode = document.getElementById('countryCode').value;
            const videoFile = document.getElementById('videoFile').files[0];

            const formData = new FormData();
            formData.append('mobile_number', mobileNumber);
            formData.append('country_code', countryCode);
            formData.append('file', videoFile);

            fetch('http://localhost:5000/analyse', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                const analysisResultsDiv = document.getElementById('analysisResults');
                analysisResultsDiv.innerHTML = JSON.stringify(data, null, 2);
                console.log(data);
                // Handle analysis results here
            })
            .catch(error => console.error('Error uploading and analysing video:', error));
        });

        // Function to fetch user data
        function getUserData() {
            const mobileNumber = document.getElementById('userDataMobileNumber').value;
            const countryCode = document.getElementById('userDataCountryCode').value;

            fetch(`http://localhost:5000/user-data?mobile_number=${mobileNumber}&country_code=${countryCode}`)
                .then(response => response.json())
                .then(data => {
                    const userDataDiv = document.getElementById('userData');
                    userDataDiv.innerHTML = JSON.stringify(data, null, 2);
                })
                .catch(error => console.error('Error fetching user data:', error));
        }

        // Function to fetch video names from the server
        function fetchVideos() {
            fetch('http://localhost:5000/videos')
                .then(response => response.json())
                .then(data => {
                    const videoList = document.getElementById('videoList');
                    videoList.style.display = 'block';
                    videoList.innerHTML = ""; // Clear previous options
                    data.forEach(video => {
                        const option = document.createElement('option');
                        option.text = video;
                        videoList.add(option);
                    });
                })
                .catch(error => console.error('Error fetching videos:', error));
        }

        // Function to fetch and display the selected video
        function displayVideo(videoName) {
            fetch(`http://localhost:5000/sendvideo?video_name=${videoName}`)
                .then(response => response.json())
                .then(data => {
                    const videoPlayer = document.getElementById('video-player');
                    const videoContainer = document.getElementById('video-container');

                    // Set the video source and display the video player
                    videoPlayer.src = `data:video/mp4;base64,${data.file_data}`;
                    videoContainer.style.display = 'block';

                    // Fetch subtitles
                    fetch(`http://localhost:5000/sendtext?text_name=${videoName}`)
                        .then(response => response.json())
                        .then(data => {
                            const subtitles = document.getElementById('subtitles');
                            subtitles.innerText = data.text_data;
                        })
                        .catch(error => console.error('Error fetching subtitles:', error));
                })
                .catch(error => console.error('Error fetching video:', error));
        }
    </script>
</body>
</html>
